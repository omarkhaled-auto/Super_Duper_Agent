@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================================================
   FlowBoard Design System — Global CSS Custom Properties
   ============================================================================
   Inspired by Linear's industrial precision: near-black dark mode, strong
   typography hierarchy, subtle borders, violet accent. NOT a Linear clone.

   Font stack:
     Heading  — Space Grotesk     (technical, clean, distinctive)
     Body     — Plus Jakarta Sans (modern, readable)
     Mono     — JetBrains Mono    (for code, task IDs)

   Color philosophy:
     Dark mode is the PRIMARY experience (matches Linear).
     Light mode is equally polished but uses the .light class.
     All colors reference CSS custom properties so theme switching
     is instant and every component automatically adapts.
   ============================================================================ */

@layer base {
  /* ========================================================================
     DARK THEME (default — :root)
     Near-black palette with subtle blue undertone, violet accent.
     ======================================================================== */
  :root {
    /* ---- Core Backgrounds ----
       Graduated scale from near-black canvas to slightly lighter surfaces.
       None of these are pure #000 — they carry the faintest warmth. */
    --color-bg-primary: 240 6% 4%;           /* #0A0A0B — app canvas */
    --color-bg-secondary: 240 5% 6.5%;       /* #0F1011 — sidebar, panels */
    --color-bg-tertiary: 240 4% 9%;          /* #151516 — cards, elevated surfaces */
    --color-bg-quaternary: 240 3% 11.5%;     /* #1C1C1E — hover wells, inset areas */
    --color-bg-elevated: 240 3% 14%;         /* #222224 — dropdowns, popovers, modals */

    /* ---- Surface Overlays (for layered compositing) ---- */
    --color-surface-overlay: 0 0% 100% / 0.03;
    --color-surface-hover: 0 0% 100% / 0.05;
    --color-surface-active: 0 0% 100% / 0.08;
    --color-surface-selected: 253 91% 67% / 0.08;

    /* ---- Text Hierarchy ----
       Four levels: primary > secondary > tertiary > quaternary */
    --color-text-primary: 0 0% 95%;          /* #F2F2F2 — headings, important text */
    --color-text-secondary: 0 0% 70%;        /* #B3B3B3 — body text */
    --color-text-tertiary: 0 0% 50%;         /* #808080 — labels, captions */
    --color-text-quaternary: 0 0% 35%;       /* #595959 — placeholders, disabled */
    --color-text-on-accent: 0 0% 100%;       /* pure white on violet buttons */

    /* ---- Borders ----
       Almost invisible structure lines — noise-free interface. */
    --color-border-default: 0 0% 100% / 0.08;
    --color-border-subtle: 0 0% 100% / 0.05;
    --color-border-strong: 0 0% 100% / 0.15;
    --color-border-accent: 253 91% 67% / 0.5;

    /* ---- Primary Accent: Violet ----
       The FlowBoard signature. CTAs, links, active states, focus rings. */
    --color-accent: 253 91% 67%;             /* #8B5CF6 */
    --color-accent-hover: 253 91% 60%;       /* #7C3AED */
    --color-accent-active: 253 91% 53%;      /* #6D28D9 */
    --color-accent-muted: 253 91% 67% / 0.15;
    --color-accent-subtle: 253 91% 67% / 0.08;

    /* ---- Priority Colors ---- */
    --color-priority-urgent: 0 84% 60%;      /* #EF4444 */
    --color-priority-high: 25 95% 53%;       /* #F97316 */
    --color-priority-medium: 48 96% 53%;     /* #EAB308 */
    --color-priority-low: 217 91% 60%;       /* #3B82F6 */
    --color-priority-none: 0 0% 35%;         /* #595959 */

    /* ---- Status Colors (Kanban Column Indicators) ---- */
    --color-status-backlog: 0 0% 45%;        /* #737373 */
    --color-status-todo: 217 91% 60%;        /* #3B82F6 */
    --color-status-in-progress: 253 91% 67%; /* #8B5CF6 */
    --color-status-in-review: 25 95% 53%;    /* #F97316 */
    --color-status-done: 142 71% 45%;        /* #22C55E */
    --color-status-cancelled: 0 0% 30%;      /* #4D4D4D */

    /* ---- Semantic Colors ---- */
    --color-success: 142 71% 45%;            /* #22C55E */
    --color-success-muted: 142 71% 45% / 0.15;
    --color-warning: 38 92% 50%;             /* #F59E0B */
    --color-warning-muted: 38 92% 50% / 0.15;
    --color-error: 0 84% 60%;               /* #EF4444 */
    --color-error-muted: 0 84% 60% / 0.15;
    --color-info: 199 89% 48%;              /* #0EA5E9 */
    --color-info-muted: 199 89% 48% / 0.15;

    /* ---- Shadows (dark mode: heavier, pure black) ---- */
    --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 0.30);
    --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.40), 0 1px 2px -1px rgb(0 0 0 / 0.40);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.40), 0 2px 4px -2px rgb(0 0 0 / 0.40);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.40), 0 4px 6px -4px rgb(0 0 0 / 0.40);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.50), 0 8px 10px -6px rgb(0 0 0 / 0.50);
    --shadow-glow: 0 0 20px rgb(139 92 246 / 0.15);

    /* ---- Border Radius ---- */
    --radius-sm: 4px;
    --radius-md: 6px;
    --radius-lg: 8px;
    --radius-xl: 12px;
    --radius-2xl: 16px;
    --radius-full: 9999px;

    /* ---- Layout Constants ---- */
    --sidebar-width: 240px;
    --sidebar-width-collapsed: 64px;
    --header-height: 48px;
    --panel-width: 480px;
    --panel-width-lg: 640px;
    --kanban-column-width: 320px;
    --kanban-column-min-width: 280px;
    --kanban-card-gap: 8px;

    /* ---- Transitions ---- */
    --transition-fast: 150ms ease-out;
    --transition-base: 200ms ease-out;
    --transition-slow: 300ms ease-out;
    --transition-spring: 300ms cubic-bezier(0.34, 1.56, 0.64, 1);

    /* ---- Z-Index Scale ---- */
    --z-base: 0;
    --z-dropdown: 50;
    --z-sticky: 100;
    --z-overlay: 200;
    --z-modal: 300;
    --z-popover: 400;
    --z-toast: 500;
    --z-command-palette: 600;
    --z-tooltip: 700;

    /* ---- Skeleton Shimmer ---- */
    --skeleton-base: 240 4% 10%;
    --skeleton-shimmer: 240 3% 16%;

    /* ==================================================================
       shadcn/ui Variable Mapping
       Maps FlowBoard tokens -> shadcn expected variable names.
       ================================================================== */
    --background: var(--color-bg-primary);
    --foreground: var(--color-text-primary);

    --card: var(--color-bg-tertiary);
    --card-foreground: var(--color-text-primary);

    --popover: var(--color-bg-elevated);
    --popover-foreground: var(--color-text-primary);

    --primary: var(--color-accent);
    --primary-foreground: var(--color-text-on-accent);

    --secondary: var(--color-bg-quaternary);
    --secondary-foreground: var(--color-text-primary);

    --muted: var(--color-bg-tertiary);
    --muted-foreground: var(--color-text-tertiary);

    --accent: var(--color-bg-quaternary);
    --accent-foreground: var(--color-text-primary);

    --destructive: var(--color-error);
    --destructive-foreground: 0 0% 100%;

    --border: var(--color-border-default);
    --input: var(--color-border-default);
    --ring: var(--color-accent);
    --radius: 0.375rem;

    /* Chart palette for Recharts */
    --chart-1: 253 91% 67%;
    --chart-2: 142 71% 45%;
    --chart-3: 217 91% 60%;
    --chart-4: 25 95% 53%;
    --chart-5: 0 84% 60%;

    /* shadcn sidebar */
    --sidebar-background: var(--color-bg-secondary);
    --sidebar-foreground: var(--color-text-secondary);
    --sidebar-primary: var(--color-accent);
    --sidebar-primary-foreground: var(--color-text-on-accent);
    --sidebar-accent: var(--color-bg-quaternary);
    --sidebar-accent-foreground: var(--color-text-primary);
    --sidebar-border: var(--color-border-subtle);
    --sidebar-ring: var(--color-accent);

    /* Legacy aliases (backward compat with existing code) */
    --urgent: var(--color-priority-urgent);
    --high: var(--color-priority-high);
    --medium: var(--color-priority-medium);
    --low: var(--color-priority-low);
  }

  /* ========================================================================
     LIGHT THEME
     Clean whites, high-contrast text, same violet accent.
     Applied via .light class on <html> (next-themes).
     ======================================================================== */
  .light {
    --color-bg-primary: 0 0% 98.5%;          /* #FBFBFC */
    --color-bg-secondary: 0 0% 96.5%;        /* #F6F6F7 */
    --color-bg-tertiary: 0 0% 100%;          /* #FFFFFF — cards */
    --color-bg-quaternary: 0 0% 95%;         /* #F2F2F3 — hover/wells */
    --color-bg-elevated: 0 0% 100%;          /* #FFFFFF — popovers */

    --color-surface-overlay: 0 0% 0% / 0.02;
    --color-surface-hover: 0 0% 0% / 0.04;
    --color-surface-active: 0 0% 0% / 0.06;
    --color-surface-selected: 253 91% 67% / 0.06;

    --color-text-primary: 240 6% 10%;         /* #191A1C */
    --color-text-secondary: 240 3% 32%;       /* #505153 */
    --color-text-tertiary: 0 0% 50%;          /* #808080 */
    --color-text-quaternary: 0 0% 65%;        /* #A6A6A6 */
    --color-text-on-accent: 0 0% 100%;

    --color-border-default: 0 0% 0% / 0.08;
    --color-border-subtle: 0 0% 0% / 0.05;
    --color-border-strong: 0 0% 0% / 0.15;
    --color-border-accent: 253 91% 67% / 0.5;

    --color-accent: 253 91% 67%;
    --color-accent-hover: 253 91% 60%;
    --color-accent-active: 253 91% 53%;
    --color-accent-muted: 253 91% 67% / 0.10;
    --color-accent-subtle: 253 91% 67% / 0.05;

    --color-priority-urgent: 0 72% 51%;       /* #DC2626 — darkened for light bg */
    --color-priority-high: 25 95% 46%;        /* #EA580C */
    --color-priority-medium: 45 93% 47%;      /* #CA8A04 */
    --color-priority-low: 217 91% 50%;        /* #2563EB */
    --color-priority-none: 0 0% 60%;

    --color-status-backlog: 0 0% 55%;
    --color-status-todo: 217 91% 50%;
    --color-status-in-progress: 253 91% 60%;
    --color-status-in-review: 25 95% 46%;
    --color-status-done: 142 71% 40%;
    --color-status-cancelled: 0 0% 60%;

    --color-success: 142 71% 40%;
    --color-success-muted: 142 71% 45% / 0.10;
    --color-warning: 38 92% 45%;
    --color-warning-muted: 38 92% 50% / 0.10;
    --color-error: 0 72% 51%;
    --color-error-muted: 0 84% 60% / 0.10;
    --color-info: 199 89% 42%;
    --color-info-muted: 199 89% 48% / 0.10;

    --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 0.04);
    --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.06), 0 1px 2px -1px rgb(0 0 0 / 0.06);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.05);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.05);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.10), 0 8px 10px -6px rgb(0 0 0 / 0.06);
    --shadow-glow: 0 0 20px rgb(139 92 246 / 0.10);

    --skeleton-base: 0 0% 93%;
    --skeleton-shimmer: 0 0% 97%;

    /* shadcn mappings (light) */
    --background: var(--color-bg-primary);
    --foreground: var(--color-text-primary);
    --card: var(--color-bg-tertiary);
    --card-foreground: var(--color-text-primary);
    --popover: var(--color-bg-elevated);
    --popover-foreground: var(--color-text-primary);
    --primary: var(--color-accent);
    --primary-foreground: var(--color-text-on-accent);
    --secondary: var(--color-bg-quaternary);
    --secondary-foreground: var(--color-text-primary);
    --muted: var(--color-bg-quaternary);
    --muted-foreground: var(--color-text-tertiary);
    --accent: var(--color-bg-quaternary);
    --accent-foreground: var(--color-text-primary);
    --destructive: var(--color-error);
    --destructive-foreground: 0 0% 100%;
    --border: var(--color-border-default);
    --input: var(--color-border-default);
    --ring: var(--color-accent);

    --sidebar-background: var(--color-bg-secondary);
    --sidebar-foreground: var(--color-text-secondary);
    --sidebar-primary: var(--color-accent);
    --sidebar-primary-foreground: var(--color-text-on-accent);
    --sidebar-accent: var(--color-bg-quaternary);
    --sidebar-accent-foreground: var(--color-text-primary);
    --sidebar-border: var(--color-border-subtle);
    --sidebar-ring: var(--color-accent);

    --urgent: var(--color-priority-urgent);
    --high: var(--color-priority-high);
    --medium: var(--color-priority-medium);
    --low: var(--color-priority-low);
  }
}

/* ==========================================================================
   BASE ELEMENT STYLES
   ========================================================================== */

@layer base {
  * {
    @apply border-border;
    box-sizing: border-box;
  }

  html {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    scroll-behavior: smooth;
  }

  body {
    @apply bg-background text-foreground;
    font-family: var(--font-body), system-ui, -apple-system, sans-serif;
    font-feature-settings: "cv02", "cv03", "cv04", "cv11";
    line-height: 1.6;
    overflow-x: hidden;
  }

  /* Heading typography — Space Grotesk */
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-heading), system-ui, -apple-system, sans-serif;
    font-weight: 700;
    line-height: 1.2;
    letter-spacing: -0.025em;
    color: hsl(var(--color-text-primary));
    text-wrap: balance;
  }
  h1 { font-size: 2.25rem; font-weight: 800; letter-spacing: -0.035em; } /* 36px */
  h2 { font-size: 1.875rem; letter-spacing: -0.03em; }                    /* 30px */
  h3 { font-size: 1.5rem; }                                                /* 24px */
  h4 { font-size: 1.25rem; }                                               /* 20px */
  h5 { font-size: 1.125rem; font-weight: 500; }                            /* 18px */
  h6 { font-size: 1rem; font-weight: 500; }                                /* 16px */

  /* Monospace elements */
  code, kbd, pre, samp {
    font-family: var(--font-mono), "Courier New", monospace;
  }

  /* Focus ring — accessible, beautiful, on-brand */
  :focus-visible {
    outline: 2px solid hsl(var(--color-accent));
    outline-offset: 2px;
    border-radius: var(--radius-sm, 4px);
  }

  /* Scrollbar (Webkit + Firefox) */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background: hsl(var(--color-text-quaternary));
    border-radius: 9999px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--color-text-tertiary));
  }
  * {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--color-text-quaternary)) transparent;
  }

  /* Selection */
  ::selection {
    background: hsl(var(--color-accent-muted));
    color: hsl(var(--color-text-primary));
  }
}

/* ==========================================================================
   COMPONENT LAYER — Reusable FlowBoard patterns
   ========================================================================== */

@layer components {
  /* ------------------------------------------------------------------
     KANBAN CARD
     ------------------------------------------------------------------ */
  .kanban-card {
    @apply relative rounded-lg border;
    background: hsl(var(--color-bg-tertiary));
    border-color: hsl(var(--color-border-subtle));
    padding: 12px 16px;
    box-shadow: var(--shadow-xs);
    transition:
      box-shadow var(--transition-fast),
      border-color var(--transition-fast),
      transform var(--transition-fast);
  }
  .kanban-card:hover {
    box-shadow: var(--shadow-sm);
    border-color: hsl(var(--color-border-default));
  }
  .kanban-card:active {
    transform: scale(0.98);
  }

  /* Priority stripe — 3px colored bar on the left edge */
  .kanban-card-priority-stripe {
    @apply absolute left-0 top-2 bottom-2 rounded-full;
    width: 3px;
  }
  .kanban-card-priority-stripe[data-priority="urgent"] {
    background: hsl(var(--color-priority-urgent));
  }
  .kanban-card-priority-stripe[data-priority="high"] {
    background: hsl(var(--color-priority-high));
  }
  .kanban-card-priority-stripe[data-priority="medium"] {
    background: hsl(var(--color-priority-medium));
  }
  .kanban-card-priority-stripe[data-priority="low"] {
    background: hsl(var(--color-priority-low));
  }
  .kanban-card-priority-stripe[data-priority="none"] {
    background: hsl(var(--color-priority-none));
  }

  /* ------------------------------------------------------------------
     KANBAN COLUMN
     ------------------------------------------------------------------ */
  .kanban-column {
    width: var(--kanban-column-width);
    min-width: var(--kanban-column-min-width);
    @apply flex flex-col;
  }
  .kanban-column-header {
    @apply flex items-center justify-between px-2 py-3;
  }
  .kanban-column-count {
    @apply text-xs font-medium rounded-full;
    padding: 2px 8px;
    background: hsl(var(--color-surface-hover));
    color: hsl(var(--color-text-tertiary));
  }

  /* ------------------------------------------------------------------
     PRIORITY BADGES
     ------------------------------------------------------------------ */
  .badge-priority {
    @apply inline-flex items-center gap-1 rounded-full text-xs font-medium;
    padding: 2px 8px;
  }
  .badge-priority[data-priority="urgent"] {
    background: hsl(var(--color-priority-urgent) / 0.15);
    color: hsl(var(--color-priority-urgent));
  }
  .badge-priority[data-priority="high"] {
    background: hsl(var(--color-priority-high) / 0.15);
    color: hsl(var(--color-priority-high));
  }
  .badge-priority[data-priority="medium"] {
    background: hsl(var(--color-priority-medium) / 0.15);
    color: hsl(var(--color-priority-medium));
  }
  .badge-priority[data-priority="low"] {
    background: hsl(var(--color-priority-low) / 0.15);
    color: hsl(var(--color-priority-low));
  }
  .badge-priority[data-priority="none"] {
    background: hsl(var(--color-priority-none) / 0.15);
    color: hsl(var(--color-priority-none));
  }

  /* ------------------------------------------------------------------
     STATUS BADGES (with colored dot)
     ------------------------------------------------------------------ */
  .badge-status {
    @apply inline-flex items-center gap-1.5 rounded-full text-xs font-medium;
    padding: 2px 8px;
    color: hsl(var(--color-text-secondary));
  }
  .badge-status::before {
    content: "";
    @apply block rounded-full;
    width: 6px;
    height: 6px;
  }
  .badge-status[data-status="backlog"]::before    { background: hsl(var(--color-status-backlog)); }
  .badge-status[data-status="todo"]::before        { background: hsl(var(--color-status-todo)); }
  .badge-status[data-status="in-progress"]::before { background: hsl(var(--color-status-in-progress)); }
  .badge-status[data-status="in-review"]::before   { background: hsl(var(--color-status-in-review)); }
  .badge-status[data-status="done"]::before        { background: hsl(var(--color-status-done)); }
  .badge-status[data-status="cancelled"]::before   { background: hsl(var(--color-status-cancelled)); }

  /* ------------------------------------------------------------------
     LABEL BADGES (colored tags)
     ------------------------------------------------------------------ */
  .badge-label {
    @apply inline-flex items-center rounded-full text-xs font-medium;
    padding: 2px 10px;
    border: 1px solid hsl(var(--color-border-subtle));
  }

  /* ------------------------------------------------------------------
     SKELETON LOADING
     ------------------------------------------------------------------ */
  .skeleton {
    @apply rounded-md;
    background: linear-gradient(
      90deg,
      hsl(var(--skeleton-base)) 0%,
      hsl(var(--skeleton-shimmer)) 50%,
      hsl(var(--skeleton-base)) 100%
    );
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s ease-in-out infinite;
  }

  @keyframes skeleton-shimmer {
    0%   { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* ------------------------------------------------------------------
     SIDEBAR
     ------------------------------------------------------------------ */
  .sidebar {
    width: var(--sidebar-width);
    background: hsl(var(--color-bg-secondary));
    border-right: 1px solid hsl(var(--color-border-subtle));
    transition: width var(--transition-slow);
    @apply flex flex-col h-full;
  }
  .sidebar.collapsed {
    width: var(--sidebar-width-collapsed);
  }
  .sidebar-item {
    @apply flex items-center gap-3 rounded-md text-sm;
    padding: 8px 12px;
    color: hsl(var(--color-text-secondary));
    transition: background var(--transition-fast), color var(--transition-fast);
  }
  .sidebar-item:hover {
    background: hsl(var(--color-surface-hover));
    color: hsl(var(--color-text-primary));
  }
  .sidebar-item.active {
    background: hsl(var(--color-surface-selected));
    color: hsl(var(--color-text-primary));
  }

  /* ------------------------------------------------------------------
     COMMAND PALETTE BACKDROP
     ------------------------------------------------------------------ */
  .command-palette-backdrop {
    @apply fixed inset-0;
    background: rgb(0 0 0 / 0.5);
    backdrop-filter: blur(4px);
    z-index: var(--z-command-palette);
  }

  /* ------------------------------------------------------------------
     SLIDE-OVER PANEL (Task Detail)
     ------------------------------------------------------------------ */
  .slide-panel {
    @apply fixed top-0 right-0 h-full;
    width: var(--panel-width);
    max-width: 100vw;
    background: hsl(var(--color-bg-secondary));
    border-left: 1px solid hsl(var(--color-border-subtle));
    box-shadow: var(--shadow-xl);
    z-index: var(--z-overlay);
    transition: transform var(--transition-slow);
  }
  .slide-panel[data-state="closed"] { transform: translateX(100%); }
  .slide-panel[data-state="open"]   { transform: translateX(0); }

  /* ------------------------------------------------------------------
     TOAST NOTIFICATIONS
     ------------------------------------------------------------------ */
  .toast-container {
    @apply fixed flex flex-col gap-2 pointer-events-none;
    bottom: 24px;
    right: 24px;
    z-index: var(--z-toast);
    max-width: 420px;
  }
  .toast {
    @apply pointer-events-auto rounded-lg border;
    padding: 12px 16px;
    background: hsl(var(--color-bg-elevated));
    border-color: hsl(var(--color-border-default));
    box-shadow: var(--shadow-lg);
    animation: toast-slide-in var(--transition-slow) ease-out;
  }
  .toast-success { border-left: 3px solid hsl(var(--color-success)); }
  .toast-error   { border-left: 3px solid hsl(var(--color-error)); }
  .toast-warning { border-left: 3px solid hsl(var(--color-warning)); }
  .toast-info    { border-left: 3px solid hsl(var(--color-info)); }

  @keyframes toast-slide-in {
    from { opacity: 0; transform: translateX(100%) scale(0.95); }
    to   { opacity: 1; transform: translateX(0) scale(1); }
  }

  /* ------------------------------------------------------------------
     DRAG AND DROP
     ------------------------------------------------------------------ */
  .dragging {
    opacity: 0.5;
    cursor: grabbing;
  }
  .drag-over {
    background: hsl(var(--color-surface-selected));
    border: 2px dashed hsl(var(--color-accent));
    border-radius: var(--radius-lg, 8px);
  }

  /* ------------------------------------------------------------------
     PRESENCE INDICATOR (online dot)
     ------------------------------------------------------------------ */
  .presence-indicator {
    @apply rounded-full;
    width: 8px;
    height: 8px;
    background: hsl(var(--color-success));
    box-shadow: 0 0 0 2px hsl(var(--color-bg-primary));
  }
  .presence-indicator.offline {
    background: hsl(var(--color-text-quaternary));
  }
}

/* ==========================================================================
   UTILITY LAYER
   ========================================================================== */

@layer utilities {
  /* Text wrapping */
  .text-balance { text-wrap: balance; }

  /* Multiline truncation */
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Fade overlays (Linear-style card fades) */
  .fade-bottom {
    mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
  }
  .fade-right {
    mask-image: linear-gradient(to right, black 80%, transparent 100%);
    -webkit-mask-image: linear-gradient(to right, black 80%, transparent 100%);
  }

  /* Link underline (matches Linear: 1.5px thick, 2.5px offset) */
  .link-underline {
    text-decoration: underline;
    text-underline-offset: 2.5px;
    text-decoration-thickness: 1.5px;
    text-decoration-color: hsl(var(--color-accent) / 0.4);
    transition: text-decoration-color var(--transition-fast);
  }
  .link-underline:hover {
    text-decoration-color: hsl(var(--color-accent));
  }

  /* Hide scrollbar */
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

  /* Frosted glass */
  .glass {
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
  }

  /* Legacy alias */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--color-text-quaternary)) transparent;
  }
  .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
  .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: hsl(var(--color-text-quaternary));
    border-radius: 3px;
  }

  /* ------------------------------------------------------------------
     MOBILE UTILITIES
     ------------------------------------------------------------------ */

  /* Touch manipulation -- prevents 300ms delay on tap */
  .touch-manipulation {
    touch-action: manipulation;
  }

  /* Mobile-only no-scrollbar (below md breakpoint) */
  @media (max-width: 767px) {
    .max-md\:no-scrollbar::-webkit-scrollbar { display: none; }
    .max-md\:no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  }

  /* Safe area bottom padding for notched devices */
  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }

  /* Snap scroll utilities */
  .snap-x {
    scroll-snap-type: x mandatory;
  }
  .snap-mandatory {
    scroll-snap-type: x mandatory;
  }
  .snap-none {
    scroll-snap-type: none;
  }
  .snap-center {
    scroll-snap-align: center;
  }
  .snap-start {
    scroll-snap-align: start;
  }
}

/* ==========================================================================
   PREFERS-REDUCED-MOTION SUPPORT
   ==========================================================================
   Disable/reduce all animations and transitions for users who prefer
   reduced motion. Uses both CSS media query and Tailwind motion-reduce:.
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  /* Disable skeleton shimmer for reduced motion */
  .skeleton {
    animation: none !important;
    background: hsl(var(--skeleton-base)) !important;
  }

  /* Disable toast slide-in */
  .toast {
    animation: none !important;
  }

  /* Disable kanban card active transform */
  .kanban-card:active {
    transform: none !important;
  }

  /* Disable smooth scroll on html */
  html {
    scroll-behavior: auto !important;
  }

  /* Disable drag overlay animation */
  [data-dnd-overlay] {
    animation: none !important;
    transition: none !important;
  }
}

/* ==========================================================================
   MOBILE RESPONSIVE OVERRIDES
   ==========================================================================
   Additional mobile-specific styles that are difficult to express
   purely with Tailwind utility classes.
   ========================================================================== */

/* iOS viewport fix for notched devices */
@supports (padding: env(safe-area-inset-bottom)) {
  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* Mobile: make slide panel full-screen */
@media (max-width: 767px) {
  /* Task detail panel full width on mobile */
  [data-side="right"][role="dialog"] {
    width: 100% !important;
    max-width: 100% !important;
  }
}

/* Responsive container padding utility */
@layer utilities {
  .container-padding {
    padding-left: 1rem;   /* 16px mobile */
    padding-right: 1rem;
  }
  @media (min-width: 768px) {
    .container-padding {
      padding-left: 1.5rem; /* 24px tablet */
      padding-right: 1.5rem;
    }
  }
  @media (min-width: 1024px) {
    .container-padding {
      padding-left: 2rem;   /* 32px desktop */
      padding-right: 2rem;
    }
  }
}
